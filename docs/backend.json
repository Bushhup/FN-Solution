{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the FN Tax Solution platform, including both regular customers and administrators, with role-based access.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "name": {
          "type": "string",
          "description": "The full name of the user."
        },
        "email": {
          "type": "string",
          "description": "The user's email address, used for login and notifications.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "The user's role on the platform, determining access level (e.g., 'User', 'Admin')."
        },
        "createdAt": {
          "type": "object",
          "description": "Timestamp indicating when the user account was created."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "role",
        "createdAt"
      ]
    },
    "Service": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Service",
      "type": "object",
      "description": "Represents a specific tax, compliance, business registration, legal, or accounting service offered by FN Tax Solution.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Service entity."
        },
        "title": {
          "type": "string",
          "description": "The name or title of the service."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of what the service entails, including its benefits and processes."
        },
        "category": {
          "type": "string",
          "description": "The broader category the service belongs to (e.g., 'GST Registration', 'Income Tax Filing', 'Company Registration')."
        },
        "createdAt": {
          "type": "object",
          "description": "Timestamp indicating when the service record was created."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "category",
        "createdAt"
      ]
    },
    "Lead": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Lead",
      "type": "object",
      "description": "Represents a service request or consultation inquiry submitted by a user or a guest through a form.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Lead entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who submitted this lead, if they were logged in. This field is optional if the lead is submitted by a guest. (Relationship: User 1:N Lead)"
        },
        "service": {
          "type": "string",
          "description": "The name of the service the inquiry is about."
        },
        "name": {
          "type": "string",
          "description": "The full name of the person submitting the lead."
        },
        "email": {
          "type": "string",
          "description": "The email address of the person submitting the lead.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The phone number of the person submitting the lead."
        },
        "message": {
          "type": "string",
          "description": "The detailed message or specific inquiry from the lead."
        },
        "status": {
          "type": "string",
          "description": "The current processing status of the lead.",
          "enum": [
            "New",
            "Pending",
            "In Progress",
            "Completed",
            "Rejected"
          ]
        },
        "createdAt": {
          "type": "object",
          "description": "Timestamp indicating when the lead was submitted."
        }
      },
      "required": [
        "id",
        "service",
        "name",
        "email",
        "phone",
        "message",
        "status",
        "createdAt"
      ]
    },
    "Testimonial": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Testimonial",
      "type": "object",
      "description": "Represents a review or feedback provided by a client of FN Tax Solution, used to build trust and credibility.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Testimonial entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the client who provided the testimonial."
        },
        "review": {
          "type": "string",
          "description": "The actual text content of the testimonial or review."
        },
        "rating": {
          "type": "number",
          "description": "The rating given by the client, typically on a scale (e.g., 1 to 5 stars)."
        },
        "createdAt": {
          "type": "object",
          "description": "Timestamp indicating when the testimonial was submitted."
        }
      },
      "required": [
        "id",
        "name",
        "review",
        "rating",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores individual user profiles. The `role` field within this document ('User' or 'Admin') is used for role-based authorization in security rules. Individual profiles can be read by their owner or an admin. Only admins are allowed to list all users or modify other users' roles."
        }
      },
      {
        "path": "/services/{serviceId}",
        "definition": {
          "entityName": "Service",
          "schema": {
            "$ref": "#/backend/entities/Service"
          },
          "description": "Catalog of available services offered by FN Tax Solution. This collection is publicly readable by all users (authenticated or anonymous). Only administrators have the ability to create, update, or delete service definitions."
        }
      },
      {
        "path": "/leads/{leadId}",
        "definition": {
          "entityName": "Lead",
          "schema": {
            "$ref": "#/backend/entities/Lead"
          },
          "description": "Stores all service inquiries and consultation requests. Authenticated users can view their own leads, while administrators can view all leads and manage their status."
        }
      },
      {
        "path": "/testimonials/{testimonialId}",
        "definition": {
          "entityName": "Testimonial",
          "schema": {
            "$ref": "#/backend/entities/Testimonial"
          },
          "description": "Customer testimonials and reviews. This collection is publicly readable by all users (authenticated or anonymous). Only administrators have the ability to create, update, or delete testimonials."
        }
      }
    ],
    "reasoning": "The recommended Firestore structure for FN Tax Solution prioritizes a scalable and secure Role-Based Access Control (RBAC) system.\n\n**Role-Based Access Control (RBAC):**\n\n1.  **User Roles (`/users/{userId}`):** Instead of a hardcoded admin email, authorization is now managed by a `role` field within each user's document in the `/users` collection. A user with `role: 'Admin'` has elevated privileges across the application. This is a more flexible and scalable approach to admin management.\n\n2.  **Admin Authorization:** Security rules now use a `get()` call to the user's own profile document (`get(/databases/$(database)/documents/users/$(request.auth.uid))`) to check their role before granting access to admin-only operations like listing all users or updating a lead's status. This ensures that admin logic is centralized and consistently applied.\n\n**QAPs (Rules are not Filters) and Structural Segregation:**\n\n1.  **Public Collections (`/services`, `/testimonials`):** These collections remain publicly readable, with write access restricted to administrators, ensuring that list operations are inherently safe and efficient.\n\n2.  **User-Owned Data (`/users/{userId}`, `/leads/{leadId}`):** User profiles are private to the owner (or an admin). Leads are private to the user who created them (or an admin). This is enforced by checking `request.auth.uid == userId` or `request.auth.uid == resource.data.userId`. This QAP-compliant approach ensures that queries for user-specific data are validated against security rules on the server, preventing data leakage."
  }
}
